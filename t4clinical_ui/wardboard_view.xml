<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
            <record model="ir.ui.view" id="view_wardboard_patient_placement_form">
                <field name="name">Wardboard Patient Placement</field>
                <field name="model">wardboard.patient.placement</field>
                <field name="arch" type="xml">
                    <form string="Wardboard Patient Placement">
						<!-- <field name="patient_id" readonly="1"/> -->
						<group string="From" colspan="4" col="2">
							<field name="ward_location_id" readonly="1"/>
							<field name="bed_src_location_id" readonly="1" />
						</group>
						<group string="To" colspan="4" col="2">
							<field name="bed_dst_location_id" width="100" domain="[('id','child_of',ward_location_id),
									                                             ('id','!=',ward_location_id),
									                                             ('id','!=',bed_src_location_id)]"/>
						</group>
						<button name="do_move" type="object" string="Move"/>
                    </form>
                </field>
            </record>    
            <record model="ir.ui.view" id="view_wardboard_device_session_start_form">
                <field name="name">Wardboard Device Session Start</field>
                <field name="model">wardboard.device.session.start</field>
                <field name="arch" type="xml">
                    <form string="Wardboard Device Session">
							<field name="patient_id" readonly="1"/>
							<field name="device_id" domain="[('is_available','=',1)]"/>
						<button name="do_start" type="object" string="Start"/>
                    </form>
                </field>
            </record>
            <record model="ir.ui.view" id="view_wardboard_device_session_complete_form">
                <field name="name">Wardboard Device Session Complete</field>
                <field name="model">wardboard.device.session.complete</field>
                <field name="arch" type="xml">
                    <form string="Wardboard Device Session Compplete" version="7.0">
                    	<label for="session_id" string="You are about to complete session: "/>
						<field name="session_id" readonly="1"/>
						<button name="do_complete" type="object" string="Complete"/>
                    </form>
                </field>
            </record>            
            <record model="ir.ui.view" id="view_wardboard_search">
                <field name="name">Wardboard Search View</field>
                <field name="model">t4.clinical.wardboard</field>
                <field name="arch" type="xml">
                    <search string="Wardboard Search View">
                    	<field name="ews_trend" />
                        <group expand="1" string="Filters">
                            <filter name="no_risk" string="No Risk" domain="[('clinical_risk','=','None')]"/>
                            <filter name="low_risk" string="Low Risk" domain="[('clinical_risk','=','Low')]"/>
                            <filter name="medium_risk" string="Medium Risk" domain="[('clinical_risk','=','Medium')]"/>
                            <filter name="high_risk" string="High Risk" domain="[('clinical_risk','=','High')]"/>
                            <filter name="ews_trend_down" string="Deteriorating Trend" domain="[('ews_trend','&lt;',0)]"/>
                            <filter name="ews_trend_up" string="Improving Trend" domain="[('ews_trend','&gt;',0)]"/>
                            <filter name="ews_trend_same" string="Unchanged Trend" domain="[('ews_trend','=',0)]"/>
                        </group>
                        <group expand="1" string="Group By...">
                            <!--<filter name="age" string="Age" domain="[]" context="{'group_by':'age'}" help="Age"/>-->
                            <filter name="clinical_risk" string="Clinical Risk" domain="[]" context="{'group_by':'clinical_risk'}" help="Clinical Risk"/>
                            <filter name="group_by_ward" string="Ward" domain="[]" context="{'group_by':'ward_id'}" help="Group by Ward"/>
                        </group>
                    </search>
                </field>
            </record>
            <record model="ir.ui.view" id="view_wardboard_tree">
                <field name="name">Wardboard Tree View</field>
                <field name="model">t4.clinical.wardboard</field>
                <field name="arch" type="xml">
                    <tree string="Wardboard Tree View" class="t4c_wardboard" version="7.0" create="0" colors="red:clinical_risk=='High'; orange:clinical_risk=='Medium'; green:clinical_risk=='Low'">
                       <button name="wardboard_chart" string="Chart" type="object" class="oe_highlight" t4_icon="chart"/>
                       <button name="wardboard_ews" string="EWS" type="object" class="oe_highlight" t4_icon="observation"/>
                        <field name="sex" widget="t4_gender" string=""/>
                       <field name="full_name" string="Patient"/>
                       <field name="location"/>
					   <field name="next_diff"/>
                       <field name="frequency" string="NEWS Frequency"/>
                       <field name="ews_score_string" string="Latest NEWS Score"/>
                       <field name="clinical_risk" invisible="1"/>
                       <field name="ews_trend_string"  widget="t4_scoretrend" string="Score Trend"/>
                    </tree>
                </field>
            </record>

            <record model="ir.ui.view" id="view_wardboard_form">
                <field name="name">Wardboard Form View</field>
                <field name="model">t4.clinical.wardboard</field>
                <field name="priority">1</field>
                <field name="arch" type="xml">
                    <form string="Wardboard Form View" version="7.0" create="0" delete="0">
                        <header>
                            <button name="wardboard_patient_placement" string="Move Patient"  type="object"/>
                            <button name="print_report" string="Print Report" type="object"/>
                            <button name="wardboard_chart" string="NEWS Chart" type="object"/>
                            <button name="wardboard_ews" string="NEWS List" type="object"/>
                            <button name="wardboard_weight_chart" string="Weight Chart" type="object"/>
                            <button name="wardboard_bs_chart" string="Blood Sugar Chart" type="object"/>
                        </header>
                        <sheet>

                            <group>
                                <group string="Early Warning Score">
                                    <field name="next_diff" readonly="1"/>
                                    <field name="frequency" readonly="1"/>
                                    <field name="ews_score" readonly="1"/>
                                    <field name="ews_trend" readonly="1"/>
                                    <field name="o2target_string" readonly="1"/>
                                </group>
                            </group>
                            <notebook>
                                <page string="Admission Details">
                                    <group>
                                        <field name="spell_code" readonly="1" string="Code"/>
                                        <field name="spell_date_started" readonly="True" string="Admission Date"/>
                                    </group>
                                    <group string="Previous admissions">
	                                    <field name="spell_ids" readonly="1" nolabel="1">
	                                        <tree>
	                                            <field name="code"/>
	                                            <field name="date_started"/>
	                                            <field name="location_id"/>
	                                        </tree>
	                                        <form>
	                                            <field name="code" />
	                                            <field name="date_started" />
	                                            <field name="location_id"/>
	                                        </form>
	                                   </field>
                                   </group>
                                </page>
                                <page string="Demographics">
                                    <group>
                                        <field name="middle_names" readonly="True"/>
                                        <field name="dob" readonly="True" widget="date"/>
                                        <field name="age" readonly="True"/>
                                        <field name="sex" readonly="True"/>
                                    </group>
                                </page>
                                <page string="Medical Details">
                                    <group>
                                        <field name="hospital_number" readonly="True" string="Hospital Number"/>
                                        <field name="nhs_number" readonly="True" string="NHS Number"/>
                                        <field name="height" string="Height (m)" readonly="1"/>
                                        <field name="mrsa"/>
                                        <field name="diabetes"/>
                                    </group>                                    
                                    <group string="Weight">
                                        <field name="weight_ids" readonly="1" nolabel="1">
                                            <tree>
                                                <field name="date_terminated" string="Date"/>
                                                <field name="weight" />
                                            </tree>
                                            <form>
                                                <field name="weight" />
                                                <field name="date_terminated" string="Date"/>
                                            </form>
                                        </field>
                                    </group>
                                    <group string="Blood Sugar">
                                    	<field name="blood_sugar_ids" readonly="1" nolabel="1">
                                            <tree>
                                                <field name="date_terminated" string="Date"/>
                                                <field name="blood_sugar"/>
                                            </tree>
                                            <form>
                                                <field name="blood_sugar"/>
                                                <field name="date_terminated" string="Date"/>
                                            </form>
                                        </field>
                                   	</group>
                                    <group string="O2 Target History">
                                        <field name="o2target_ids" nolabel="1" readonly="1">
                                            <tree>
                                                <field name="level_id"/>
                                            </tree>
                                            <form>
                                                <field name="level_id"/>
                                            </form>
                                       </field>
                                    </group>
                                </page>
                                <page string="Movements">
                                    <field name="move_ids" readonly="1">
                                        <tree>
                                            <field name="location_id" />
                                            <field name="date_terminated" />
                                            <field name="state" />
                                        </tree>
                                        <form>
                                            <field name="location_id" />
                                            <field name="patient_id" />
                                        </form>
                                   </field>
                                </page>
                                <page string="Devices">
                                    	<group string="Active Device Sessions">
                                    	<div>
                                    		<group>
	                                    		<button name="device_session_start" type="object" string="Start Device Session"/>
                                    		</group>
                                    		<newline/>
	                                    	<field name="started_device_session_ids" readonly="1" nolabel="1" domain="[('state','=','started')]">
 	                                    		<tree>
		                                    		<field name="device_id"/>
		                                    		<field name="date_started"/>
		                                    		<button name="device_session_complete" type="object" icon="gtk-cancel" string="Complete Device Session"/>
	                                    		</tree>
	                                    	</field>
	                                    </div>
	                                    </group>
	                                    <newline/>
	                                    <group string="Device Sessions History">
	                                    	<field name="terminated_device_session_ids" readonly="1" nolabel="1" domain="[('state','=','completed')]">
	                                    		<tree>
		                                    		<field name="device_id"/>
		                                    		<field name="date_started"/>
		                                    		<field name="date_terminated"/>
		                                    		<field name="state"/>
		                                    		
	                                    		</tree>
	                                    	</field>
	                                    </group>
                                </page>
                            </notebook>
                        </sheet>
                    </form>
                </field>
            </record>

            <!--Charts-->
            <record model="ir.ui.view" id="view_wardboard_chart_form">
                <field name="name">Wardboard Chart Form View</field>
                <field name="model">t4.clinical.wardboard</field>
                <field name="arch" type="xml">
                    <form string="Wardboard EWS Chart Form View" version="7.0" create="0">
                        <sheet>
                            <button name="print_chart" string="Print" type="object" class="oe_highlight"/>
                            <field name="ews_ids" widget="t4_ewschart"/>
                        </sheet>
                    </form>
                </field>
            </record>

            <record model="ir.ui.view" id="view_wardboard_weight_chart_form">
                <field name="name">Wardboard Weight Chart Form View</field>
                <field name="model">t4.clinical.wardboard</field>
                <field name="arch" type="xml">
                    <form string="Wardboard Weight Chart Form View" version="7.0" create="0">
                        <sheet>
                            <field name="weight_ids" widget="t4_weightchart"/>
                        </sheet>
                    </form>
                </field>
            </record>

            <record model="ir.ui.view" id="view_wardboard_bs_chart_form">
                <field name="name">Wardboard Blood Sugar Chart Form View</field>
                <field name="model">t4.clinical.wardboard</field>
                <field name="arch" type="xml">
                    <form string="Wardboard Blood Sugar Chart Form View" version="7.0" create="0">
                        <sheet>
                            <field name="blood_sugar_ids" widget="t4_bschart"/>
                        </sheet>
                    </form>
                </field>
            </record>

            <record model="ir.ui.view" id="view_wardboard_print_chart_form">
                <field name="name">Wardboard Print Chart Form View</field>
                <field name="model">t4.clinical.wardboard</field>
                <field name="arch" type="xml">
                    <form string="Wardboard Print Form View" version="7.0" create="0">
                        <sheet>
                            <div class="oe_title">
                                <label string="Name" for="full_name"/>
                                <h1><field name="full_name" readonly="1"/></h1>
                            </div>

                            <group>
                                <group string="Personal Information">
                                    <field name="middle_names" readonly="1"/>
                                    <field name="dob" readonly="1" widget="date"/>
                                    <field name="age" readonly="1"/>
                                    <field name="sex" readonly="1"/>

                                </group>
                                <group string="Hospital Information">
                                    <field name="location" readonly="1"/>
                                    <field name="location_id" readonly="1" invisible="1"/>
                                    <field name="hospital_number" readonly="1"/>
                                    <field name="nhs_number" readonly="1"/>
                                </group>
                                <group string="Early Warning Score">
                                    <field name="next_diff" readonly="1"/>
                                    <field name="frequency" readonly="1"/>
                                    <field name="ews_score" readonly="1"/>
                                    <field name="ews_trend" readonly="1"/>
                                    <field name="o2target_string" readonly="1"/>
                                </group>
                            </group>
                            <field name="ews_ids" widget="t4_ewschart"/>
                        </sheet>
                    </form>
                </field>
            </record>

            <record model="ir.ui.view" id="view_wardboard_print_report_form">
                <field name="name">Wardboard Print Report Form View</field>
                <field name="model">t4.clinical.wardboard</field>
                <field name="arch" type="xml">
                    <form string="Wardboard Print Report Form View" version="7.0" create="0">
                        <sheet>
                            <div class="oe_title">
                                <label string="Name" for="full_name"/>
                                <h1><field name="full_name" readonly="1"/></h1>
                            </div>
                            <div class="oe_company_logo">
                                <field name="company_logo" readonly="1" widget="image" width="300"/>
                            </div>

                            <group>
                                <group string="Personal Information">
                                    <field name="middle_names" readonly="1"/>
                                    <field name="dob" readonly="1" widget="date"/>
                                    <field name="age" readonly="1"/>
                                    <field name="sex" readonly="1"/>

                                </group>
                                <group string="Hospital Information">
                                    <field name="location" readonly="1"/>
                                    <field name="location_id" readonly="1" invisible="1"/>
                                    <field name="hospital_number" readonly="1"/>
                                    <field name="nhs_number" readonly="1"/>
                                </group>
                                <group string="Early Warning Score">
                                    <field name="next_diff" readonly="1"/>
                                    <field name="frequency" readonly="1"/>
                                    <field name="ews_score" readonly="1"/>
                                    <field name="ews_trend" readonly="1"/>
                                    <field name="o2target_string" readonly="1"/>
                                </group>
                                <group string="Admission">
                                    <field name="spell_date_started" readonly="1"/>
                                    <field name="spell_code" readonly="1"/>
                                </group>
                            </group>
                            <field name="ews_ids" widget="t4_ewschart" nolabel="1"/>
                            <group string="EWS List">
                                <field name="ews_list_ids" nolabel="1" readonly="1"/>
                            </group>
                            <group string="Device Sessions History">
                                <field name="terminated_device_session_ids" readonly="1" nolabel="1">
                                    <tree>
                                        <field name="device_id"/>
                                        <field name="date_started"/>
                                        <field name="date_terminated"/>
                                        <field name="state"/>
                                    </tree>
                                </field>
                            </group>
                        </sheet>
                    </form>
                </field>
            </record>
	        <!-- Wardboard Kanban View -->
	        <record model="ir.ui.view" id="view_wardboard_kanban">
	            <field name="name">t4.clinical.wardboard.kanban</field>
	            <field name="model">t4.clinical.wardboard</field>
	            <field name="arch" type="xml">
	                <kanban edit="false" quick_create="false" create="false">
                        <field name="full_name" />
                        <field name="location" />
                        <field name="sex"/>
                        <field name="dob"/>
                        <field name="age" />
                        <field name="next_diff" />
                        <field name="frequency" />
                        <field name="ews_score_string" />
                        <field name="ews_trend_string"/>
                        <templates>
                            <t t-name="kanban-box">
                                <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                    <div class="oe_kanban_content">
                                        <div><field name="location"/></div>
                                        <div><b><field name="full_name"/></b> (<field name="age"/>)
                                            <t t-if="record.sex.raw_value === 'M'">
                                                <img t-attf-src="/t4clinical_ui/static/src/img/icons/male.png" t-att-alt="Male"/>
                                            </t>
                                            <t t-if="record.sex.raw_value === 'F'">
                                                <img t-attf-src="/t4clinical_ui/static/src/img/icons/female.png" t-att-alt="Female"/>
                                            </t>
                                        </div>
                                        <div>Score: <field name="ews_score_string"/>
                                            <t t-if="record.ews_trend_string.raw_value === 'up'">
                                                <img t-attf-src="/t4clinical_ui/static/src/img/icons/level-up.png" t-att-alt="up"/>
                                            </t>
                                            <t t-if="record.ews_trend_string.raw_value === 'down'">
                                                <img t-attf-src="/t4clinical_ui/static/src/img/icons/level-down.png" t-att-alt="down"/>
                                            </t>
                                            <t t-if="record.ews_trend_string.raw_value === 'same'">
                                                <img t-attf-src="/t4clinical_ui/static/src/img/icons/level-same.png" t-att-alt="same"/>
                                            </t>
                                            <t t-if="record.ews_trend_string.raw_value === 'one'">
                                                n/a
                                            </t>
                                            <t t-if="record.ews_trend_string.raw_value === 'none'">
                                                n/a
                                            </t>
                                        </div>
                                        <li>Time to next observation:<field name="next_diff"/></li>
                                        <t t-if="record.hospital_number.raw_value != ''">
                                            <div>Hospital Number: <field name="hospital_number"/></div>
                                        </t>
                                        <t t-if="record.nhs_number.raw_value != ''">
                                            <div>NHS Number: <field name="nhs_number"/></div>
                                        </t>
                                    </div>
                                </div>
                            </t>
                        </templates>
	                </kanban>
	            </field>
	        </record>
            <record model="ir.actions.act_window" id="action_wardboard" >
                <field name="name">Wardboard</field>
                <field name="res_model">t4.clinical.wardboard</field>
                <field name="view_type">form</field>
                <field name="view_mode">kanban,tree,form</field>
                <field name="domain">[('next_diff','!=',False)]</field>
                <field name="context">{'search_default_clinical_risk':1}</field>
                <field name="search_view_id" ref="view_wardboard_search"/>
            </record>
            <record model="ir.actions.act_window.view" id="act_view_wardboard_tree">
                <field eval="1" name="sequence"/>
                <field name="view_mode">tree</field>
                <field name="view_id" ref="view_wardboard_tree"/>
                <field name="act_window_id" ref="action_wardboard"/>
            </record>
            <record model="ir.actions.act_window.view" id="act_view_wardboard_form">
                <field eval="2" name="sequence"/>
                <field name="view_mode">form</field>
                <field name="view_id" ref="view_wardboard_form"/>
                <field name="act_window_id" ref="action_wardboard"/>
            </record>
            <record model="ir.actions.act_window.view" id="act_view_wardboard_kanban">
                <field eval="0" name="sequence"/>
                <field name="view_mode">kanban</field>
                <field name="view_id" ref="view_wardboard_kanban"/>
                <field name="act_window_id" ref="action_wardboard"/>
            </record>

            <record model="ir.actions.act_window" id="action_patients_by_ward" >
                <field name="name">Wardboard</field>
                <field name="res_model">t4.clinical.wardboard</field>
                <field name="view_type">form</field>
                <field name="view_mode">tree,form,kanban</field>
                <field name="domain">[('next_diff','!=',False)]</field>
                <field name="context">{'search_default_group_by_ward':1}</field>
                <field name="search_view_id" ref="view_wardboard_search"/>
            </record>
            <record model="ir.actions.act_window.view" id="act_view_patients_by_ward_tree">
                <field eval="0" name="sequence"/>
                <field name="view_mode">tree</field>
                <field name="view_id" ref="view_wardboard_tree"/>
                <field name="act_window_id" ref="action_patients_by_ward"/>
            </record>
            <record model="ir.actions.act_window.view" id="act_view_patients_by_ward_form">
                <field eval="1" name="sequence"/>
                <field name="view_mode">form</field>
                <field name="view_id" ref="view_wardboard_form"/>
                <field name="act_window_id" ref="action_patients_by_ward"/>
            </record>
            <record model="ir.actions.act_window.view" id="act_view_patients_by_ward_kanban">
                <field eval="2" name="sequence"/>
                <field name="view_mode">kanban</field>
                <field name="view_id" ref="view_wardboard_kanban"/>
                <field name="act_window_id" ref="action_patients_by_ward"/>
            </record>
    </data>
</openerp>